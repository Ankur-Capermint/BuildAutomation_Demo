name: Unity Build Pipeline

on:
  workflow_dispatch:
    inputs:
      branch:
        description: 'Select the branch to build'
        required: true
        type: choice
        options:
          - main
          - dev
          - stage
          - prod
        default: main

      platform:
        description: 'Select the build platform'
        required: true
        type: choice
        options:
          - Android
          - iOS
          - Windows
          - macOS
        default: Android

      # Platform-specific choices (conditional inputs can be added manually)
      architecture:
        description: 'Select the build architecture'
        required: true
        type: choice
        options:
          - x86
          - x64
          - ARM
        default: x86

      configuration:
        description: 'Select the build configuration'
        required: true
        type: choice
        options:
          - Debug
          - Release
        default: Debug

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # Checkout code from the selected branch
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          repository: 'https://github.com/Ankur-Capermint/BuildAutomation_Demo.git'
          token: ${{ secrets.GITHUB_TOKEN }}
          ref: ${{ github.event.inputs.branch }}

      # Set up Unity with the correct action
      - name: Set up Unity
        uses: game-ci/unity-builder@v4  # Correct Unity setup action
        with:
          customImage: 'unityci/editor:6000.0.30f1'  # Specify the Unity version (adjust if necessary)

      # Build Unity project based on platform and configuration
      - name: Build Unity project
        run: |
          unity -batchmode -quit -projectPath ./ \
          -buildTarget ${{ github.event.inputs.platform }} \
          -architecture ${{ github.event.inputs.architecture }} \
          -buildPath ./build_output \
          -configuration ${{ github.event.inputs.configuration }} \
          -buildName "Build_${{ github.event.inputs.platform }}_${{ github.event.inputs.configuration }}"
